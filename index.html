<!DOCTYPE html>
<html lang="pt-br">
	<head>
		<title>Su Store</title>

		<!-- Estilos -->
		<link rel="stylesheet" type="text/css" href="css/bootstrap.css">
		<link href="https://fonts.googleapis.com/css?family=Roboto:100,100i,300,300i,400,400i,500,500i,700,700i,900,900i" rel="stylesheet">
		<link rel="stylesheet" type="text/css" href="css/modal-cart.css">
		<link rel="stylesheet" type="text/css" href="css/modal-not-found.css">
		<link rel="stylesheet" type="text/css" href="css/general.css">
		<link rel="stylesheet" type="text/css" href="css/fancybox/jquery.fancybox.min.css">
		<link rel="stylesheet" type="text/css" href="css/menu-hamburguer.css">

		<!-- Jquery -->
		<script src="https://code.jquery.com/jquery-3.2.1.min.js" type="text/javascript"></script>
		<script src="js/general.js" type="text/javascript"></script>
		<script src="js/elevate-zoom/jquery.elevateZoom-3.0.8.min.js" type="text/javascript" charset="utf-8"></script>
		<script src="js/fancybox/jquery.fancybox.min.js" type="text/javascript" charset="utf-8" async defer></script>
		<script src="js/jquery-ui/jquery-ui.min.js" type="text/javascript" charset="utf-8"></script>

		<!-- Metas -->
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
	</head>
	
	<body>
	<script>
		// Tabs que apresentam a descrição do produto e o compartilhamento
		$( function() {
			$( "#tabs" ).tabs();
		} );
	</script>

		<header id="header">
			<div class="col-xs-12 header__init flex">
				<div class="col-xs-3">
					<a title="Pagina Inicial">
						<img src="img/logo-sustores.png" alt="Su Store" class="logo">
					</a>
				</div>

				<div class="col-xs-6 search__content">
					<input type="search" name="search" id="txtSearch" placeholder="Pesquisar" class="col-xs-12 search">
				</div>

				<div class="col-xs-3 flex align-center icons__content">
					<div class="col-xs-6 not-found">Entrar</div>
					<div class="col-xs-3 not-found">
						<!-- Icone Globo -->
						<img src="img/globo.svg">
					</div>
					
					<div class="col-xs-3">
						<!-- Icone Sacola -->
						<div id="one" class="button-bag" onclick="openCart()">
							<img src="img/sacola.svg" alt="">
						</div>
					</div>

					<?php // Menu Hamburguer que será mostrado só no responsivo ?>
					<div id="menu__hamburguer">
						<span></span>
						<span></span>
						<span></span>
						<span></span>
						<span></span>
						<span></span>
					</div>
				</div>

				<div id="modal-container" class="col-xs-5">
					<div class="modal-background">
						
						<div class="modal col-xs-5">
							<!-- Botoes -->
							<div class="col-xs-6 bg-cinza button" id="button_continue">Continuar Comprando</div>
							<div class="col-xs-6 bg-verde button" id="button_checkout">Checkout</div>
							<div class="allProductsCart"></div>

							

							<div class="col-xs-12 modal__frete">
								<div class="col-xs-6">Taxa de Frete: </div>
								<div class="col-xs-6 price">R$ 00,00</div>
							</div>
							<div class="col-xs-12 line"></div>

							<div class="col-xs-12 total">
								<div class="col-xs-6">Total</div>
								<div class="col-xs-6 price"><span id="valorTotal"></span></div>
							</div>



							<svg class="modal-svg" xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" preserveAspectRatio="none">
								<rect x="0" y="0" fill="none" width="226" height="162" rx="3" ry="3"></rect>
							</svg>
						</div>
					</div>
				</div>
			</div>

			<div class="modal-not-found">
				<div class="modal-background">
					
					<div class="modal col-xs-5">
						<h1>Loja em construção.</h1>

					</div>
				</div>
			</div>



			<div class="col-xs-12 menu">
				<div class="col-xs-3"></div>

				<div class="col-xs-6">
					<ul class="menu__ul col-xs-12 flex flex-center">
						<li class="col-xs-4">
							<a id="1-0" title="">Feminino</a>
							<span>+</span>
							<ul class="submenu">
								<li><a id="1-1" title="">Roupas</a></li>
								<li><a id="1-2" title="">Sapatos</a></li>
							</ul>
						</li>

						<li class="col-xs-4">
							<a id="2-0" title="">Masculino</a>
							<span>+</span>
							<ul class="submenu">
								<li><a id="2-1" title="">Roupas</a></li>
								<li><a id="2-2" title="">Sapatos</a></li>
							</ul>
						</li>

						<li class="col-xs-4">
							<a id="3-0" title="">Infantil</a>
							<span>+</span>
							<ul class="submenu">
								<li><a id="3-1" title="">Roupas</a></li>
								<li><a id="3-2" title="">Calçados</a></li>
							</ul>
						</li>
					</ul>
				</div>

				<div class="col-xs-3">

				</div>
			</div>
		</header><!-- /header -->

		<div class="index col-xs-12">
			<div class="category__block">
				<h1> Todos os produtos </h1>
			</div>

			<div class="col-xs-12 sort-order">
				<div class="col-xs-10"></div>
				
				<select class="col-xs-2 sort-order-info">
					<option value="=">Ordenar Por</option>
					<option value="0">A-Z</option>
					<option value="1">Z-A</option>
				</select>

			</div>
		</div>

		<div class="product col-xs-12 hide">

			<div class="col-xs-6 product_img">
				<div class="col-xs-9">
					<img src="" alt="" id="zoom" class="imagemproduct1">
				</div>

				<div class="col-xs-3" id="gallery">
					<a href="#" data-image="img/camiseta.jpeg" data-zoom-image="img/camiseta.jpeg" class="imagemZoomproduct2">
						<img src="" alt="" id="zoom" class="imagemproduct2">
					</a>
					<a href="#" data-image="img/roupas.jpg" data-zoom-image="img/roupas.jpg" class="imagemZoomproduct1">
						<img src="" alt="" id="zoom" class="imagemproduct1">
					</a>
				</div>
			</div>

			<div class="col-xs-6 product__info-text">
				<h1 id="nameproduct"> product 1 </h1>

				<div class="col-xs-12 price" id="priceproduct">
					R$ 10,00
				</div>

				<div class="col-xs-12">
					<input type="number" name="amount" placeholder="Quantidade" class="amount" >
				</div>

				<div class="col-xs-12 add-cart">
					<img src="img/carrinho.svg" alt="" class="cart">
					Adicionar carrinho
				</div>
			</div>

			<div class="col-xs-12">
				<div id="tabs">
					<ul class="flex">
						<li><a href="#tabs-1">Descrição</a></li>
						<li><a href="#tabs-2">Compartilhar</a></li>
					</ul>

					<div id="tabs-1">
						<p></p>
					</div>
					<div id="tabs-2">
						<p>Compartilhar este produto em suas redes sociais.</p>
						<img src="img/facebook-logo.svg" alt="" class="not-found">
						<img src="img/twitter.svg" alt="" class="not-found">
						<img src="img/pinterest.svg" alt="" class="not-found">
					</div>
				</div>
			</div>
		</div>

		<footer class="col-xs-12">
			<img src="img/computador.svg" alt="">
			Desenvolvido por Suelen Magnaterra
		</footer>
	</body>
	

	<script>	
		//funcão para converter número para R$
		function numberToReal(numero) { 
		    var numero = numero.toFixed(2).split('.'); //quebra string no ponto
		    numero[0] = "R$ " + numero[0].split(/(?=(?:...)*$)/).join('.'); //gera o decimal em R$
		    return numero.join(','); //retorna o valor formatado
		}

		var carrinho = []; //array que armazena os itens adicionados no carrinho de compras 

		$( document ).ready(function() { 

			
			//função para carregar os produtos do json
			//value: parametro que recebe o ID da categoria e ID da subcategoria (0-0)
			//tipo: parametro que recebe o tipo da ação (clique no menu, pequisa ou ordenação)
			function loadProducts(value, tipo){ 
				$(".index").removeClass('hide'); //remove a classe hide da classe index
				$(".product").addClass('hide'); //adiciona a classe hide na classe produto
				$('.zoomContainer').remove();  //remove o efeito de zoom nas imagens do produto especifico para evitar conflitos

				var typeSort = $(".sort-order-info").val();

				//se o valor da variável for indefinido, atribui 0-0
				if(value === undefined){
					value = "0-0";
				}

				var arrValue = value.split("-"); 
				var idCat = arrValue[0]; 
				var idSub = arrValue[1];
				var idSub = parseInt(idSub); 
				var txtSearch = $(".search").val();


				//se tipo de load de produtos for 2, limpa o input de pesquisa
				if(tipo == 2){
					txtSearch = "";
					$(".search").val("");
				}
				
				//retorna os valores do json de acordo com os parametros
				$.getJSON( "products.json", function( data ) {
					var items = [];

					//percorre os dados do json de produtos
					$.each( data, function( key, val ) {
						
						//verifica se o id da categoria do json é igual ao id categoria do parametro ou id da categoria do parametro for igual a 0 (0 significa que não há filtro, ou seja, para carregar a página inicial)
						if((val.catId == idCat) || (idCat == 0)){


							//verifica se o id da subcategoria do json é igual ao id subcategoria do parametro ou id da subcategoria do parametro for igual a 0 (0 significa que não há subcategoria, ou seja, deve carregar somente a categoria)
							if((val.subCat == idSub) || (idSub == 0)){

								//se id da subcategoria for diferente de 0, atribui o nome da subcagoria na categoria, esse nome será apresentado no título da página
								if (idSub != 0){
									var subCatNome = val.subCatNome;
								} else{
									var subCatNome = '';
								}


								//Define as imagens do topo da página a serem apresentadas de acordo com cada categoria. Caso 0, não aparesenta nenhuma imagem, pois se trata na página inicial.
								if(parseInt(val.catId) == 1){
									$(".category__block").html('<img src="img/roupas.jpg" alt="" class="banner"><h1> Feminino ' + subCatNome + '</h1>');
								} else if (parseInt(val.catId) == 2){
									$(".category__block").html('<img src="img/camiseta3.jpg" alt="" class="banner"><h1> Masculino ' + subCatNome + ' </h1>');
								} else if (parseInt(val.catId) == 3){
									$(".category__block").html('<img src="img/infantil2.jpg" alt="" class="banner"><h1> Infantil ' + subCatNome + ' </h1>');
								} 
								if (parseInt(idCat) == 0){
									$(".category__block").html('<h1> TODOS OS PRODUTOS </h1>');
								}

								var strNomeJson = val.nome.toUpperCase();
								var idSearch = strNomeJson.search(txtSearch.toUpperCase());

								//Caso seja utilizado o filtro de pesquisa, a condição deve ser atendida com base no nome do do product para que os itens seja apresentados. O filtro funciona com case sensitive e deve-se usar palavras especificas
								if(parseInt(idSearch) >= 0){
								
									//adiciona os itens no array para apresentação na tela
									items.push('<div class="col-xs-3 products__grid '+val.nome.toLowerCase()+'">\
										<a onclick="loadProductUnit(this.id)" class="products__click" id="'+val.id+'">\
											<img src="img/'+val.img1+'" alt="">\
											<h2> '+val.nome+' </h2>\
											<div class="products__grid-price">\
											R$'+val.preco+'\
											</div>\
										</a>\
									</div>')
								}

							}
						} 
					});

					//define os parametros de ordenação de acordo a seleção
					if(typeSort == 0){
						$(".full__content").html(items.sort().join( "" ))
					}else if(typeSort == 1){
						$(".full__content").html(items.sort().reverse().join( "" ))
					}else{
						$(".full__content").html(items.join( "" ));
					}
					$(".sort-order-info").attr('id', value);

				});
			}

			
			//executa os carregamentos dos produtos de acordo com cada ação da página
			$( ".sort-order-info" ).change(function() {
				loadProducts($(this).attr('id'),1);
			});
			$(".menu__ul a").click(function() {
				loadProducts($(this).attr('id'),2);
			});
			$(".search").keypress(function(e) {
				if(e.which == 13) {
					loadProducts($(".sort-order-info").attr('id'),3);
				}
			});
			$(".logo").click(function() {
				loadProducts("0-0",0);
			});

			
			//função para adicionar os itens no carrinho, essa função é baseada em um array, que armazena as informações do ID do produtos e quatidade no vetor, dessa maneira os itens só serão mantidos até que a página seja atualizada.
			$(".add-cart").click(function() {
				var id = $(this).attr('id');
				var amount = $(".amount").val();
				 
				
				//verifica se a amount é menor ou igual a 0 ou igual vazio, caso seja, retorna falso e solicita um valor
				if( parseInt(amount) <= 0 || amount == '' ) {
					alert("Preencha o campo de quantidade");
					$(".amount").focus();
					return false;
				}

				//caso não haja valor no index do array, adiciona 0
				if(carrinho[id] == undefined){
					carrinho[id] = 0
				}
				
				//adiciona o id do produto e a quantidade no array
				carrinho[id] = carrinho[id]+parseInt(amount);
				
				//exibe a mensagem de adicionado com sucesso e reseta o input quantidade
				alert("Produto adicionado com sucesso!");
				$(".amount").val("");
			});
	
		})

	
		//função para carregar um produto especifico com base no ID
		function loadProductUnit(id){

			//retorna os valores do json de acordo com os parametros
			$.getJSON( "products.json", function( data ) {
				var items = [];
			
				//percorre os dados do json de produtos
				$.each( data, function( key, val ) {
					
   					//verifica se o ID do parametro é igual ao id do produto do json
					if(parseInt(id) == parseInt(val.id)){

						
						//altera classes e conteúdos de acordo com as novas informações do produto especifico vindo do json
						$(".index").addClass('hide');
						$(".product").removeClass('hide');
						$(".imagemproduct1").attr("src","img/"+val.img1);
						$(".imagemZoomproduct1").attr("data-zoom-image","img/"+val.img1);
						$(".imagemZoomproduct1").attr("data-image","img/"+val.img1);
						$(".imagemZoomproduct2").attr("data-zoom-image","img/"+val.img2);
						$(".imagemZoomproduct2").attr("data-image","img/"+val.img2);
						$(".imagemproduct2").attr("src","img/"+val.img2);
						$(".add-cart").attr({id: val.id});
						$(".amount").attr({id: 'amount'+val.id});
						$("#nameproduct").html(val.nome);
						$("#priceproduct").html(val.preco);
						$("#tabs-1").html(val.descricao);

						
						//função de zoom na imagem com o passar do mouse
						$("#zoom").elevateZoom({gallery:'gallery', cursor: 'pointer', responsive:true,  galleryActiveClass: 'active', imageCrossfade: true, loadingIcon: 'http://www.elevateweb.co.uk/spinner.gif'}); 

							$("#zoom").bind("click", function(e) {  
							  var ez =   $('#zoom').data('elevateZoom');	
								$.fancybox(ez.getGalleryList());
							  return false;
						});
					}

				});
			});

		}

		
		//função para abrir o carrinho de compras e apresentar os itens adicionados
		function openCart(){
			var valorTotal = 0;
			var items = [];

			
			//percorre os dados do array carrinho
			$.each(carrinho, function( key, value ) {
				
				
				//verifica se o valor não é indefinido		
				if(value != undefined){
					var id = key;
					var amount = value;
					
					//retorna os valores do json de acordo com os parametros
					$.getJSON( "products.json", function( data ) {
						
						
						//percorre os dados do json de produtos
						$.each( data, function( key, val ) {
							
						  	//verifica se o ID do parametro é igal ao id do produto do json
						  	if(parseInt(id) == parseInt(val.id)){
						  		
						  		//adiciona os itens no array para apresentação no carrinho
							    items.push('<div class="col-xs-12 modal__info">\
									<div class="col-xs-3"><img src="img/'+val.img1+'" alt=""></div>\
									<div class="col-xs-6">'+val.nome+'<br>Qtd: '+amount+'<br>Valor Unitário: R$ '+val.preco+'</div>\
									<div class="col-xs-3 price">'+numberToReal(parseFloat(val.preco)*parseInt(amount))+'</div>\
								</div>')
								
								//atribui o valor do produto multiplicado pela quantidade ao valor total 
								valorTotal = valorTotal+(parseFloat(val.preco)*parseInt(amount));

							}
						});

						
						//adiciona o array no carrinho de compras
						$('.allProductsCart').html(items.join( "" ));
						
						//formata o valor total dos produtos adicionados
			 			$("#valorTotal").html(numberToReal(valorTotal));
					});
				}
			});	
		}

		
		//função para carregamento inicial dos produtos
		function loadInit(){
			$(".index").removeClass('hide');  //remove a classe hide da classe index 
			$(".product").addClass('hide');  //adiciona a classe hide da classe produtos 
			$('.zoomContainer').remove();  //remove o efeito de zoom nas imagens do produtos especifico para evitar conflitos 
			
			
			//retorna os valores do json de acordo com os parametros
    		$.getJSON( "products.json", function( data ) {
			  var items = [];
			  
			  	//percorre os dados do json de produtos
			  	$.each( data, function( key, val ) {
			  	
			  		//adiciona os itens no array para apresentação na página
			    	items.push('<div class="col-xs-3 products__grid">\
			    				<a onclick="loadProductUnit(this.id)" class="products__click" id="'+val.id+'">\
									<img src="img/'+val.img1+'" alt="">\
									<h2> '+val.nome+' </h2>\
									<div class="products__grid-price">\
										R$'+val.preco+'\
									</div>\
								</a>\
							</div>')
					});

					$( "<div>", {
					"class": "full__content",
					html: items.join( "" )
				}).appendTo( ".index" );
			});
		}
		loadInit();
	</script>
</html>